apiVersion: v1
kind: Secret
metadata:
  name: shopify-secrets
type: Opaque
stringData:
  SHOPIFY_API_KEY: "d3d070cea5fca7ab9ded6a39b7b5f856"
  SHOPIFY_API_SECRET: "effc36d148a11c59102715f05c2ef2aa"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: shopify-app
  labels:
    app: shopify-app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: shopify-app
  template:
    metadata:
      labels:
        app: shopify-app
    spec:
      imagePullSecrets:
        - name: regcred2
      containers:
      - name: shopify-app
        image: registry.myella.app/kodex:8  # Replace with your image name
        ports:
        - containerPort: 8081
        env:
        - name: SHOPIFY_API_KEY
          valueFrom:
            secretKeyRef:
              name: shopify-secrets
              key: SHOPIFY_API_KEY
        - name: SHOPIFY_API_SECRET
          valueFrom:
            secretKeyRef:
              name: shopify-secrets
              key: SHOPIFY_API_SECRET
        - name: SCOPES
          value: "read_online_store_pages,read_products,read_themes,write_products,write_themes"
        - name: HOST
          value: "https://kodex.ruraldevs.dev"  # Replace with your actual domain
        - name: PORT
          value: "8081"
        - name: VITE_SHOPIFY_API_KEY
          valueFrom:
            secretKeyRef:
              name: shopify-secrets
              key: SHOPIFY_API_KEY
        - name: BACKEND_PORT
          value: "8081"
        - name: FRONTEND_PORT
          value: "8081"
        - name: NODE_ENV
          value: "production"
      #   - name: SQLITE_PATH
      #     value: "/app/data/database.sqlite"
      #   volumeMounts:
      #   - name: shopify-data
      #     mountPath: /app/data
      # volumes:
      # - name: shopify-data
      #   persistentVolumeClaim:
      #     claimName: shopify-data-pvc
